
Modify the existing FastAPI backend to implement an AI Financial Advisor feature using Ollama with the `phi3:mini-3b` model.
The goal is to create a pipeline that:
1) retrieves the user’s financial activity from the past 7 days,
2) generates a short financial overview summary,
3) refines the user’s input prompt,
4) merges everything into a single structured prompt, and
5) sends it to Ollama for inference.

Requirements

Use Ollama
- Assume Ollama is running locally
- Call model using HTTP API
- Model name: phi3:mini-3b

Create required backend components
- SQLAlchemy models
- Pydantic schemas
- CRUD functions
- FastAPI router + endpoints


Data Layer Requirements

Create or update:
FinancialTransaction model
Fields:
- id
- user_id
- category
- amount
- type (income/expense)
- timestamp

CRUD function:
- get_user_transactions_last_7_days(user_id: int)


Schemas

Create schemas for:
- FinancialTransaction
- AIAdvisorRequest (user_prompt, user_id)
- AIAdvisorResponse (summary, advice, raw_model_output)


AI Advisor Workflow

Implement service ai_advisor.generate_advice(user_id, user_prompt) that:

1) Fetches past 7 days of transactions
2) Generates a concise financial overview:
   - total income
   - total expenses
   - savings delta
   - spending highlights

3) Builds a refined system prompt:

You are a helpful financial advisor.
Provide short, practical, friendly guidance.
Avoid disclaimers. Avoid extreme risk suggestions.

User financial overview (last 7 days):
{generated_overview}

User question:
{user_prompt}

Rewrite the question into a clearer, more specific financial question.
Then provide a concise financial insight (3–5 bullet points).

4) Sends merged prompt to Ollama:

POST → http://localhost:11434/api/generate

Body:

model: "phi3:mini-3b"
prompt: <final_combined_prompt>
stream: false

5) Returns structured result.


API Endpoint

Create endpoint:
POST /ai/advisor

Request body:
- user_id
- user_prompt

Response body:
- past_7_day_summary
- refined_prompt
- advisor_response


Additional Requirements

- Keep responses short and friendly
- Handle empty-data cases gracefully
- Include docstrings + comments
- Organize code by modules:
  - models/
  - schemas/
  - crud/
  - services/
  - routers/


Acceptance Criteria

- Endpoint compiles and runs
- Works even if some transaction categories are missing
- Uses Ollama + phi-3 mini 3B only
- Output is:
  - short
  - insightful
  - non-technical
  - disclaimer‑free
